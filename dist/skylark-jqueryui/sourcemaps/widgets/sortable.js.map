{"version":3,"sources":["widgets/sortable.js"],"names":["define","$","widget","ui","mouse","version","widgetEventPrefix","ready","options","appendTo","axis","connectWith","containment","cursor","cursorAt","dropOnEmpty","forcePlaceholderSize","forceHelperSize","grid","handle","helper","items","opacity","placeholder","revert","scroll","scrollSensitivity","scrollSpeed","scope","tolerance","zIndex","activate","beforeStop","change","deactivate","out","over","receive","remove","sort","start","stop","update","_isOverAxis","x","reference","size","_isFloating","item","test","css","_create","this","containerCache","_addClass","refresh","offset","element","_mouseInit","_setHandleClassName","_setOption","key","value","_super","that","_removeClass","find","each","instance","_destroy","_mouseDestroy","i","length","removeData","widgetName","_mouseCapture","event","overrideHandle","currentItem","validHandle","reverting","disabled","type","_refreshItems","target","parents","data","addBack","_removeCurrentsFromItems","_mouseStart","noActivation","body","o","currentContainer","refreshPositions","parent","_createHelper","_cacheHelperProportions","_cacheMargins","top","margins","left","extend","click","pageX","pageY","relative","_getRelativeOffset","cssPosition","_adjustOffsetFromHelper","domPosition","prev","hide","_createPlaceholder","scrollParent","_getParentOffset","_setContainment","document","storedCursor","storedStylesheet","_storedZIndex","_storedOpacity","tagName","overflowOffset","_trigger","_uiHash","_preserveHelperProportions","containers","ddmanager","current","dropBehaviour","prepareOffsets","dragging","is","detach","position","originalPosition","_generatePosition","originalPageX","originalPageY","lastPositionAbs","positionAbs","_convertPositionTo","_mouseDrag","_scroll","scrolled","offsetHeight","scrollTop","offsetWidth","scrollLeft","window","height","width","itemElement","intersection","style","_contactContainers","innermostContainer","_refreshItemPositions","dragDirection","vertical","_getDragVerticalDirection","horizontal","_getDragHorizontalDirection","_intersectsWithPointer","contains","direction","_intersectsWithSides","_rearrange","drag","_mouseStop","noPropagation","drop","cur","animation","offsetParent","animate","parseInt","_clear","cancel","_mouseUp","Event","_storedCSS","show","parentNode","removeChild","_noFinalSort","after","prepend","serialize","_getItemsAsjQuery","connected","str","res","attr","attribute","match","expression","push","join","toArray","ret","_intersectsWith","x1","x2","helperProportions","y1","y2","l","r","t","b","dyClick","dxClick","isOverElementHeight","isOverElementWidth","isOverElement","forcePointerForContainers","floating","verticalDirection","horizontalDirection","isOverBottomHalf","isOverRightHalf","delta","_connectWith","constructor","String","addItems","j","inst","queries","widgetFullName","isFunction","call","not","list","grep","targetData","_queries","queriesLength","fast","p","toleranceElement","outerWidth","outerHeight","custom","refreshContainers","className","nodeName","toLowerCase","_createTrPlaceholder","eq","container","innerHeight","innerWidth","sourceTr","targetTr","children","dist","itemWithLeastDistance","posProperty","sizeProperty","nearBottom","innermostIndex","Math","abs","apply","clone","appendChild","obj","split","isArray","right","bottom","po","ie","ce","co","scrollHeight","max","scrollWidth","d","pos","mod","scrollIsRootNode","round","a","hardRefresh","insertBefore","nextSibling","counter","_delay","delayEvent","delayedTriggers","before","fromOutside","c","cancelHelperRemoval","Widget","prototype","arguments","_inst","sender"],"mappings":"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","file":"../../widgets/sortable.js","sourcesContent":["/*!\r\n * jQuery UI Sortable @VERSION\r\n * http://jqueryui.com\r\n *\r\n * Copyright jQuery Foundation and other contributors\r\n * Released under the MIT license.\r\n * http://jquery.org/license\r\n */\r\n\r\n//>>label: Sortable\r\n//>>group: Interactions\r\n//>>description: Enables items in a list to be sorted using the mouse.\r\n//>>docs: http://api.jqueryui.com/sortable/\r\n//>>demos: http://jqueryui.com/sortable/\r\n//>>css.structure: ../../themes/base/sortable.css\r\n\r\ndefine( [\r\n\t\t\t\"skylark-jquery\",\r\n\t\t\t\"./mouse\",\r\n\t\t\t\"../data\",\r\n\t\t\t\"../ie\",\r\n\t\t\t\"../scroll-parent\",\r\n\t\t\t\"../version\",\r\n\t\t\t\"../widget\"\r\n],function( $ ) {\r\n\r\nreturn $.widget( \"ui.sortable\", $.ui.mouse, {\r\n\tversion: \"@VERSION\",\r\n\twidgetEventPrefix: \"sort\",\r\n\tready: false,\r\n\toptions: {\r\n\t\tappendTo: \"parent\",\r\n\t\taxis: false,\r\n\t\tconnectWith: false,\r\n\t\tcontainment: false,\r\n\t\tcursor: \"auto\",\r\n\t\tcursorAt: false,\r\n\t\tdropOnEmpty: true,\r\n\t\tforcePlaceholderSize: false,\r\n\t\tforceHelperSize: false,\r\n\t\tgrid: false,\r\n\t\thandle: false,\r\n\t\thelper: \"original\",\r\n\t\titems: \"> *\",\r\n\t\topacity: false,\r\n\t\tplaceholder: false,\r\n\t\trevert: false,\r\n\t\tscroll: true,\r\n\t\tscrollSensitivity: 20,\r\n\t\tscrollSpeed: 20,\r\n\t\tscope: \"default\",\r\n\t\ttolerance: \"intersect\",\r\n\t\tzIndex: 1000,\r\n\r\n\t\t// Callbacks\r\n\t\tactivate: null,\r\n\t\tbeforeStop: null,\r\n\t\tchange: null,\r\n\t\tdeactivate: null,\r\n\t\tout: null,\r\n\t\tover: null,\r\n\t\treceive: null,\r\n\t\tremove: null,\r\n\t\tsort: null,\r\n\t\tstart: null,\r\n\t\tstop: null,\r\n\t\tupdate: null\r\n\t},\r\n\r\n\t_isOverAxis: function( x, reference, size ) {\r\n\t\treturn ( x >= reference ) && ( x < ( reference + size ) );\r\n\t},\r\n\r\n\t_isFloating: function( item ) {\r\n\t\treturn ( /left|right/ ).test( item.css( \"float\" ) ) ||\r\n\t\t\t( /inline|table-cell/ ).test( item.css( \"display\" ) );\r\n\t},\r\n\r\n\t_create: function() {\r\n\t\tthis.containerCache = {};\r\n\t\tthis._addClass( \"ui-sortable\" );\r\n\r\n\t\t//Get the items\r\n\t\tthis.refresh();\r\n\r\n\t\t//Let's determine the parent's offset\r\n\t\tthis.offset = this.element.offset();\r\n\r\n\t\t//Initialize mouse events for interaction\r\n\t\tthis._mouseInit();\r\n\r\n\t\tthis._setHandleClassName();\r\n\r\n\t\t//We're ready to go\r\n\t\tthis.ready = true;\r\n\r\n\t},\r\n\r\n\t_setOption: function( key, value ) {\r\n\t\tthis._super( key, value );\r\n\r\n\t\tif ( key === \"handle\" ) {\r\n\t\t\tthis._setHandleClassName();\r\n\t\t}\r\n\t},\r\n\r\n\t_setHandleClassName: function() {\r\n\t\tvar that = this;\r\n\t\tthis._removeClass( this.element.find( \".ui-sortable-handle\" ), \"ui-sortable-handle\" );\r\n\t\t$.each( this.items, function() {\r\n\t\t\tthat._addClass(\r\n\t\t\t\tthis.instance.options.handle ?\r\n\t\t\t\t\tthis.item.find( this.instance.options.handle ) :\r\n\t\t\t\t\tthis.item,\r\n\t\t\t\t\"ui-sortable-handle\"\r\n\t\t\t);\r\n\t\t} );\r\n\t},\r\n\r\n\t_destroy: function() {\r\n\t\tthis._mouseDestroy();\r\n\r\n\t\tfor ( var i = this.items.length - 1; i >= 0; i-- ) {\r\n\t\t\tthis.items[ i ].item.removeData( this.widgetName + \"-item\" );\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_mouseCapture: function( event, overrideHandle ) {\r\n\t\tvar currentItem = null,\r\n\t\t\tvalidHandle = false,\r\n\t\t\tthat = this;\r\n\r\n\t\tif ( this.reverting ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif ( this.options.disabled || this.options.type === \"static\" ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t//We have to refresh the items data once first\r\n\t\tthis._refreshItems( event );\r\n\r\n\t\t//Find out if the clicked node (or one of its parents) is a actual item in this.items\r\n\t\t$( event.target ).parents().each( function() {\r\n\t\t\tif ( $.data( this, that.widgetName + \"-item\" ) === that ) {\r\n\t\t\t\tcurrentItem = $( this );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\t\tif ( $.data( event.target, that.widgetName + \"-item\" ) === that ) {\r\n\t\t\tcurrentItem = $( event.target );\r\n\t\t}\r\n\r\n\t\tif ( !currentItem ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif ( this.options.handle && !overrideHandle ) {\r\n\t\t\t$( this.options.handle, currentItem ).find( \"*\" ).addBack().each( function() {\r\n\t\t\t\tif ( this === event.target ) {\r\n\t\t\t\t\tvalidHandle = true;\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t\tif ( !validHandle ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.currentItem = currentItem;\r\n\t\tthis._removeCurrentsFromItems();\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t_mouseStart: function( event, overrideHandle, noActivation ) {\r\n\r\n\t\tvar i, body,\r\n\t\t\to = this.options;\r\n\r\n\t\tthis.currentContainer = this;\r\n\r\n\t\t//We only need to call refreshPositions, because the refreshItems call has been moved to\r\n\t\t// mouseCapture\r\n\t\tthis.refreshPositions();\r\n\r\n\t\t//Prepare the dragged items parent\r\n\t\tthis.appendTo = $( o.appendTo !== \"parent\" ?\r\n\t\t\t\to.appendTo :\r\n\t\t\t\tthis.currentItem.parent() );\r\n\r\n\t\t//Create and append the visible helper\r\n\t\tthis.helper = this._createHelper( event );\r\n\r\n\t\t//Cache the helper size\r\n\t\tthis._cacheHelperProportions();\r\n\r\n\t\t/*\r\n\t\t * - Position generation -\r\n\t\t * This block generates everything position related - it's the core of draggables.\r\n\t\t */\r\n\r\n\t\t//Cache the margins of the original element\r\n\t\tthis._cacheMargins();\r\n\r\n\t\t//The element's absolute position on the page minus margins\r\n\t\tthis.offset = this.currentItem.offset();\r\n\t\tthis.offset = {\r\n\t\t\ttop: this.offset.top - this.margins.top,\r\n\t\t\tleft: this.offset.left - this.margins.left\r\n\t\t};\r\n\r\n\t\t$.extend( this.offset, {\r\n\t\t\tclick: { //Where the click happened, relative to the element\r\n\t\t\t\tleft: event.pageX - this.offset.left,\r\n\t\t\t\ttop: event.pageY - this.offset.top\r\n\t\t\t},\r\n\r\n\t\t\t// This is a relative to absolute position minus the actual position calculation -\r\n\t\t\t// only used for relative positioned helper\r\n\t\t\trelative: this._getRelativeOffset()\r\n\t\t} );\r\n\r\n\t\t// After we get the helper offset, but before we get the parent offset we can\r\n\t\t// change the helper's position to absolute\r\n\t\t// TODO: Still need to figure out a way to make relative sorting possible\r\n\t\tthis.helper.css( \"position\", \"absolute\" );\r\n\t\tthis.cssPosition = this.helper.css( \"position\" );\r\n\r\n\t\t//Adjust the mouse offset relative to the helper if \"cursorAt\" is supplied\r\n\t\t( o.cursorAt && this._adjustOffsetFromHelper( o.cursorAt ) );\r\n\r\n\t\t//Cache the former DOM position\r\n\t\tthis.domPosition = {\r\n\t\t\tprev: this.currentItem.prev()[ 0 ],\r\n\t\t\tparent: this.currentItem.parent()[ 0 ]\r\n\t\t};\r\n\r\n\t\t// If the helper is not the original, hide the original so it's not playing any role during\r\n\t\t// the drag, won't cause anything bad this way\r\n\t\tif ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {\r\n\t\t\tthis.currentItem.hide();\r\n\t\t}\r\n\r\n\t\t//Create the placeholder\r\n\t\tthis._createPlaceholder();\r\n\r\n\t\t//Get the next scrolling parent\r\n\t\tthis.scrollParent = this.placeholder.scrollParent();\r\n\r\n\t\t$.extend( this.offset, {\r\n\t\t\tparent: this._getParentOffset()\r\n\t\t} );\r\n\r\n\t\t//Set a containment if given in the options\r\n\t\tif ( o.containment ) {\r\n\t\t\tthis._setContainment();\r\n\t\t}\r\n\r\n\t\tif ( o.cursor && o.cursor !== \"auto\" ) { // cursor option\r\n\t\t\tbody = this.document.find( \"body\" );\r\n\r\n\t\t\t// Support: IE\r\n\t\t\tthis.storedCursor = body.css( \"cursor\" );\r\n\t\t\tbody.css( \"cursor\", o.cursor );\r\n\r\n\t\t\tthis.storedStylesheet =\r\n\t\t\t\t$( \"<style>*{ cursor: \" + o.cursor + \" !important; }</style>\" ).appendTo( body );\r\n\t\t}\r\n\r\n\t\t// We need to make sure to grab the zIndex before setting the\r\n\t\t// opacity, because setting the opacity to anything lower than 1\r\n\t\t// causes the zIndex to change from \"auto\" to 0.\r\n\t\tif ( o.zIndex ) { // zIndex option\r\n\t\t\tif ( this.helper.css( \"zIndex\" ) ) {\r\n\t\t\t\tthis._storedZIndex = this.helper.css( \"zIndex\" );\r\n\t\t\t}\r\n\t\t\tthis.helper.css( \"zIndex\", o.zIndex );\r\n\t\t}\r\n\r\n\t\tif ( o.opacity ) { // opacity option\r\n\t\t\tif ( this.helper.css( \"opacity\" ) ) {\r\n\t\t\t\tthis._storedOpacity = this.helper.css( \"opacity\" );\r\n\t\t\t}\r\n\t\t\tthis.helper.css( \"opacity\", o.opacity );\r\n\t\t}\r\n\r\n\t\t//Prepare scrolling\r\n\t\tif ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\tthis.scrollParent[ 0 ].tagName !== \"HTML\" ) {\r\n\t\t\tthis.overflowOffset = this.scrollParent.offset();\r\n\t\t}\r\n\r\n\t\t//Call callbacks\r\n\t\tthis._trigger( \"start\", event, this._uiHash() );\r\n\r\n\t\t//Recache the helper size\r\n\t\tif ( !this._preserveHelperProportions ) {\r\n\t\t\tthis._cacheHelperProportions();\r\n\t\t}\r\n\r\n\t\t//Post \"activate\" events to possible containers\r\n\t\tif ( !noActivation ) {\r\n\t\t\tfor ( i = this.containers.length - 1; i >= 0; i-- ) {\r\n\t\t\t\tthis.containers[ i ]._trigger( \"activate\", event, this._uiHash( this ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Prepare possible droppables\r\n\t\tif ( $.ui.ddmanager ) {\r\n\t\t\t$.ui.ddmanager.current = this;\r\n\t\t}\r\n\r\n\t\tif ( $.ui.ddmanager && !o.dropBehaviour ) {\r\n\t\t\t$.ui.ddmanager.prepareOffsets( this, event );\r\n\t\t}\r\n\r\n\t\tthis.dragging = true;\r\n\r\n\t\tthis._addClass( this.helper, \"ui-sortable-helper\" );\r\n\r\n\t\t//Move the helper, if needed\r\n\t\tif ( !this.helper.parent().is( this.appendTo ) ) {\r\n\t\t\tthis.helper.detach().appendTo( this.appendTo );\r\n\r\n\t\t\t//Update position\r\n\t\t\tthis.offset.parent = this._getParentOffset();\r\n\t\t}\r\n\r\n\t\t//Generate the original position\r\n\t\tthis.position = this.originalPosition = this._generatePosition( event );\r\n\t\tthis.originalPageX = event.pageX;\r\n\t\tthis.originalPageY = event.pageY;\r\n\t\tthis.lastPositionAbs = this.positionAbs = this._convertPositionTo( \"absolute\" );\r\n\r\n\t\tthis._mouseDrag( event );\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t_scroll: function( event ) {\r\n\t\tvar o = this.options,\r\n\t\t\tscrolled = false;\r\n\r\n\t\tif ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\tthis.scrollParent[ 0 ].tagName !== \"HTML\" ) {\r\n\r\n\t\t\tif ( ( this.overflowOffset.top + this.scrollParent[ 0 ].offsetHeight ) -\r\n\t\t\t\t\tevent.pageY < o.scrollSensitivity ) {\r\n\t\t\t\tthis.scrollParent[ 0 ].scrollTop =\r\n\t\t\t\t\tscrolled = this.scrollParent[ 0 ].scrollTop + o.scrollSpeed;\r\n\t\t\t} else if ( event.pageY - this.overflowOffset.top < o.scrollSensitivity ) {\r\n\t\t\t\tthis.scrollParent[ 0 ].scrollTop =\r\n\t\t\t\t\tscrolled = this.scrollParent[ 0 ].scrollTop - o.scrollSpeed;\r\n\t\t\t}\r\n\r\n\t\t\tif ( ( this.overflowOffset.left + this.scrollParent[ 0 ].offsetWidth ) -\r\n\t\t\t\t\tevent.pageX < o.scrollSensitivity ) {\r\n\t\t\t\tthis.scrollParent[ 0 ].scrollLeft = scrolled =\r\n\t\t\t\t\tthis.scrollParent[ 0 ].scrollLeft + o.scrollSpeed;\r\n\t\t\t} else if ( event.pageX - this.overflowOffset.left < o.scrollSensitivity ) {\r\n\t\t\t\tthis.scrollParent[ 0 ].scrollLeft = scrolled =\r\n\t\t\t\t\tthis.scrollParent[ 0 ].scrollLeft - o.scrollSpeed;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( event.pageY - this.document.scrollTop() < o.scrollSensitivity ) {\r\n\t\t\t\tscrolled = this.document.scrollTop( this.document.scrollTop() - o.scrollSpeed );\r\n\t\t\t} else if ( this.window.height() - ( event.pageY - this.document.scrollTop() ) <\r\n\t\t\t\t\to.scrollSensitivity ) {\r\n\t\t\t\tscrolled = this.document.scrollTop( this.document.scrollTop() + o.scrollSpeed );\r\n\t\t\t}\r\n\r\n\t\t\tif ( event.pageX - this.document.scrollLeft() < o.scrollSensitivity ) {\r\n\t\t\t\tscrolled = this.document.scrollLeft(\r\n\t\t\t\t\tthis.document.scrollLeft() - o.scrollSpeed\r\n\t\t\t\t);\r\n\t\t\t} else if ( this.window.width() - ( event.pageX - this.document.scrollLeft() ) <\r\n\t\t\t\t\to.scrollSensitivity ) {\r\n\t\t\t\tscrolled = this.document.scrollLeft(\r\n\t\t\t\t\tthis.document.scrollLeft() + o.scrollSpeed\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn scrolled;\r\n\t},\r\n\r\n\t_mouseDrag: function( event ) {\r\n\t\tvar i, item, itemElement, intersection,\r\n\t\t\to = this.options;\r\n\r\n\t\t//Compute the helpers position\r\n\t\tthis.position = this._generatePosition( event );\r\n\t\tthis.positionAbs = this._convertPositionTo( \"absolute\" );\r\n\r\n\t\t//Set the helper position\r\n\t\tif ( !this.options.axis || this.options.axis !== \"y\" ) {\r\n\t\t\tthis.helper[ 0 ].style.left = this.position.left + \"px\";\r\n\t\t}\r\n\t\tif ( !this.options.axis || this.options.axis !== \"x\" ) {\r\n\t\t\tthis.helper[ 0 ].style.top = this.position.top + \"px\";\r\n\t\t}\r\n\r\n\t\t//Post events to containers\r\n\t\tthis._contactContainers( event );\r\n\r\n\t\tif ( this.innermostContainer !== null ) {\r\n\r\n\t\t\t//Do scrolling\r\n\t\t\tif ( o.scroll ) {\r\n\t\t\t\tif ( this._scroll( event ) !== false ) {\r\n\r\n\t\t\t\t\t//Update item positions used in position checks\r\n\t\t\t\t\tthis._refreshItemPositions( true );\r\n\r\n\t\t\t\t\tif ( $.ui.ddmanager && !o.dropBehaviour ) {\r\n\t\t\t\t\t\t$.ui.ddmanager.prepareOffsets( this, event );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.dragDirection = {\r\n\t\t\t\tvertical: this._getDragVerticalDirection(),\r\n\t\t\t\thorizontal: this._getDragHorizontalDirection()\r\n\t\t\t};\r\n\r\n\t\t\t//Rearrange\r\n\t\t\tfor ( i = this.items.length - 1; i >= 0; i-- ) {\r\n\r\n\t\t\t\t//Cache variables and intersection, continue if no intersection\r\n\t\t\t\titem = this.items[ i ];\r\n\t\t\t\titemElement = item.item[ 0 ];\r\n\t\t\t\tintersection = this._intersectsWithPointer( item );\r\n\t\t\t\tif ( !intersection ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Only put the placeholder inside the current Container, skip all\r\n\t\t\t\t// items from other containers. This works because when moving\r\n\t\t\t\t// an item from one container to another the\r\n\t\t\t\t// currentContainer is switched before the placeholder is moved.\r\n\t\t\t\t//\r\n\t\t\t\t// Without this, moving items in \"sub-sortables\" can cause\r\n\t\t\t\t// the placeholder to jitter between the outer and inner container.\r\n\t\t\t\tif ( item.instance !== this.currentContainer ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cannot intersect with itself\r\n\t\t\t\t// no useless actions that have been done before\r\n\t\t\t\t// no action if the item moved is the parent of the item checked\r\n\t\t\t\tif ( itemElement !== this.currentItem[ 0 ] &&\r\n\t\t\t\t\tthis.placeholder[ intersection === 1 ?\r\n\t\t\t\t\t\"next\" : \"prev\" ]()[ 0 ] !== itemElement &&\r\n\t\t\t\t\t!$.contains( this.placeholder[ 0 ], itemElement ) &&\r\n\t\t\t\t\t( this.options.type === \"semi-dynamic\" ?\r\n\t\t\t\t\t\t!$.contains( this.element[ 0 ], itemElement ) :\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\r\n\t\t\t\t\tthis.direction = intersection === 1 ? \"down\" : \"up\";\r\n\r\n\t\t\t\t\tif ( this.options.tolerance === \"pointer\" ||\r\n\t\t\t\t\t\t\tthis._intersectsWithSides( item ) ) {\r\n\t\t\t\t\t\tthis._rearrange( event, item );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._trigger( \"change\", event, this._uiHash() );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Interconnect with droppables\r\n\t\tif ( $.ui.ddmanager ) {\r\n\t\t\t$.ui.ddmanager.drag( this, event );\r\n\t\t}\r\n\r\n\t\t//Call callbacks\r\n\t\tthis._trigger( \"sort\", event, this._uiHash() );\r\n\r\n\t\tthis.lastPositionAbs = this.positionAbs;\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\t_mouseStop: function( event, noPropagation ) {\r\n\r\n\t\tif ( !event ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//If we are using droppables, inform the manager about the drop\r\n\t\tif ( $.ui.ddmanager && !this.options.dropBehaviour ) {\r\n\t\t\t$.ui.ddmanager.drop( this, event );\r\n\t\t}\r\n\r\n\t\tif ( this.options.revert ) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tcur = this.placeholder.offset(),\r\n\t\t\t\taxis = this.options.axis,\r\n\t\t\t\tanimation = {};\r\n\r\n\t\t\tif ( !axis || axis === \"x\" ) {\r\n\t\t\t\tanimation.left = cur.left - this.offset.parent.left - this.margins.left +\r\n\t\t\t\t\t( this.offsetParent[ 0 ] === this.document[ 0 ].body ?\r\n\t\t\t\t\t\t0 :\r\n\t\t\t\t\t\tthis.offsetParent[ 0 ].scrollLeft\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif ( !axis || axis === \"y\" ) {\r\n\t\t\t\tanimation.top = cur.top - this.offset.parent.top - this.margins.top +\r\n\t\t\t\t\t( this.offsetParent[ 0 ] === this.document[ 0 ].body ?\r\n\t\t\t\t\t\t0 :\r\n\t\t\t\t\t\tthis.offsetParent[ 0 ].scrollTop\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tthis.reverting = true;\r\n\t\t\t$( this.helper ).animate(\r\n\t\t\t\tanimation,\r\n\t\t\t\tparseInt( this.options.revert, 10 ) || 500,\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\tthat._clear( event );\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis._clear( event, noPropagation );\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tcancel: function() {\r\n\r\n\t\tif ( this.dragging ) {\r\n\r\n\t\t\tthis._mouseUp( new $.Event( \"mouseup\", { target: null }));\r\n\r\n\t\t\tif ( this.options.helper === \"original\" ) {\r\n\t\t\t\tthis.currentItem.css( this._storedCSS );\r\n\t\t\t\tthis._removeClass( this.currentItem, \"ui-sortable-helper\" );\r\n\t\t\t} else {\r\n\t\t\t\tthis.currentItem.show();\r\n\t\t\t}\r\n\r\n\t\t\t//Post deactivating events to containers\r\n\t\t\tfor ( var i = this.containers.length - 1; i >= 0; i-- ) {\r\n\t\t\t\tthis.containers[ i ]._trigger( \"deactivate\", null, this._uiHash( this ) );\r\n\t\t\t\tif ( this.containers[ i ].containerCache.over ) {\r\n\t\t\t\t\tthis.containers[ i ]._trigger( \"out\", null, this._uiHash( this ) );\r\n\t\t\t\t\tthis.containers[ i ].containerCache.over = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.placeholder ) {\r\n\r\n\t\t\t//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,\r\n\t\t\t// it unbinds ALL events from the original node!\r\n\t\t\tif ( this.placeholder[ 0 ].parentNode ) {\r\n\t\t\t\tthis.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );\r\n\t\t\t}\r\n\t\t\tif ( this.options.helper !== \"original\" && this.helper &&\r\n\t\t\t\t\tthis.helper[ 0 ].parentNode ) {\r\n\t\t\t\tthis.helper.remove();\r\n\t\t\t}\r\n\r\n\t\t\t$.extend( this, {\r\n\t\t\t\thelper: null,\r\n\t\t\t\tdragging: false,\r\n\t\t\t\treverting: false,\r\n\t\t\t\t_noFinalSort: null\r\n\t\t\t} );\r\n\r\n\t\t\tif ( this.domPosition.prev ) {\r\n\t\t\t\t$( this.domPosition.prev ).after( this.currentItem );\r\n\t\t\t} else {\r\n\t\t\t\t$( this.domPosition.parent ).prepend( this.currentItem );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tserialize: function( o ) {\r\n\r\n\t\tvar items = this._getItemsAsjQuery( o && o.connected ),\r\n\t\t\tstr = [];\r\n\t\to = o || {};\r\n\r\n\t\t$( items ).each( function() {\r\n\t\t\tvar res = ( $( o.item || this ).attr( o.attribute || \"id\" ) || \"\" )\r\n\t\t\t\t.match( o.expression || ( /(.+)[\\-=_](.+)/ ) );\r\n\t\t\tif ( res ) {\r\n\t\t\t\tstr.push(\r\n\t\t\t\t\t( o.key || res[ 1 ] + \"[]\" ) +\r\n\t\t\t\t\t\"=\" + ( o.key && o.expression ? res[ 1 ] : res[ 2 ] ) );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tif ( !str.length && o.key ) {\r\n\t\t\tstr.push( o.key + \"=\" );\r\n\t\t}\r\n\r\n\t\treturn str.join( \"&\" );\r\n\r\n\t},\r\n\r\n\ttoArray: function( o ) {\r\n\r\n\t\tvar items = this._getItemsAsjQuery( o && o.connected ),\r\n\t\t\tret = [];\r\n\r\n\t\to = o || {};\r\n\r\n\t\titems.each( function() {\r\n\t\t\tret.push( $( o.item || this ).attr( o.attribute || \"id\" ) || \"\" );\r\n\t\t} );\r\n\t\treturn ret;\r\n\r\n\t},\r\n\r\n\t/* Be careful with the following core functions */\r\n\t_intersectsWith: function( item ) {\r\n\r\n\t\tvar x1 = this.positionAbs.left,\r\n\t\t\tx2 = x1 + this.helperProportions.width,\r\n\t\t\ty1 = this.positionAbs.top,\r\n\t\t\ty2 = y1 + this.helperProportions.height,\r\n\t\t\tl = item.left,\r\n\t\t\tr = l + item.width,\r\n\t\t\tt = item.top,\r\n\t\t\tb = t + item.height,\r\n\t\t\tdyClick = this.offset.click.top,\r\n\t\t\tdxClick = this.offset.click.left,\r\n\t\t\tisOverElementHeight = ( this.options.axis === \"x\" ) || ( ( y1 + dyClick ) > t &&\r\n\t\t\t\t( y1 + dyClick ) < b ),\r\n\t\t\tisOverElementWidth = ( this.options.axis === \"y\" ) || ( ( x1 + dxClick ) > l &&\r\n\t\t\t\t( x1 + dxClick ) < r ),\r\n\t\t\tisOverElement = isOverElementHeight && isOverElementWidth;\r\n\r\n\t\tif ( this.options.tolerance === \"pointer\" ||\r\n\t\t\tthis.options.forcePointerForContainers ||\r\n\t\t\t( this.options.tolerance !== \"pointer\" &&\r\n\t\t\t\tthis.helperProportions[ this.floating ? \"width\" : \"height\" ] >\r\n\t\t\t\titem[ this.floating ? \"width\" : \"height\" ] )\r\n\t\t) {\r\n\t\t\treturn isOverElement;\r\n\t\t} else {\r\n\r\n\t\t\treturn ( l < x1 + ( this.helperProportions.width / 2 ) && // Right Half\r\n\t\t\t\tx2 - ( this.helperProportions.width / 2 ) < r && // Left Half\r\n\t\t\t\tt < y1 + ( this.helperProportions.height / 2 ) && // Bottom Half\r\n\t\t\t\ty2 - ( this.helperProportions.height / 2 ) < b ); // Top Half\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t_intersectsWithPointer: function( item ) {\r\n\t\tvar verticalDirection, horizontalDirection,\r\n\t\t\tisOverElementHeight = ( this.options.axis === \"x\" ) ||\r\n\t\t\t\tthis._isOverAxis(\r\n\t\t\t\t\tthis.positionAbs.top + this.offset.click.top, item.top, item.height ),\r\n\t\t\tisOverElementWidth = ( this.options.axis === \"y\" ) ||\r\n\t\t\t\tthis._isOverAxis(\r\n\t\t\t\t\tthis.positionAbs.left + this.offset.click.left, item.left, item.width ),\r\n\t\t\tisOverElement = isOverElementHeight && isOverElementWidth;\r\n\r\n\t\tif ( !isOverElement ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tverticalDirection = this.dragDirection.vertical;\r\n\t\thorizontalDirection = this.dragDirection.horizontal;\r\n\r\n\t\treturn this.floating ?\r\n\t\t\t( ( horizontalDirection === \"right\" || verticalDirection === \"down\" ) ? 2 : 1 )\r\n\t\t\t: ( verticalDirection && ( verticalDirection === \"down\" ? 2 : 1 ) );\r\n\r\n\t},\r\n\r\n\t_intersectsWithSides: function( item ) {\r\n\r\n\t\tvar isOverBottomHalf = this._isOverAxis( this.positionAbs.top +\r\n\t\t\t\tthis.offset.click.top, item.top + ( item.height / 2 ), item.height ),\r\n\t\t\tisOverRightHalf = this._isOverAxis( this.positionAbs.left +\r\n\t\t\t\tthis.offset.click.left, item.left + ( item.width / 2 ), item.width ),\r\n\t\t\tverticalDirection = this.dragDirection.vertical,\r\n\t\t\thorizontalDirection = this.dragDirection.horizontal;\r\n\r\n\t\tif ( this.floating && horizontalDirection ) {\r\n\t\t\treturn ( ( horizontalDirection === \"right\" && isOverRightHalf ) ||\r\n\t\t\t\t( horizontalDirection === \"left\" && !isOverRightHalf ) );\r\n\t\t} else {\r\n\t\t\treturn verticalDirection && ( ( verticalDirection === \"down\" && isOverBottomHalf ) ||\r\n\t\t\t\t( verticalDirection === \"up\" && !isOverBottomHalf ) );\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_getDragVerticalDirection: function() {\r\n\t\tvar delta = this.positionAbs.top - this.lastPositionAbs.top;\r\n\t\treturn delta !== 0 && ( delta > 0 ? \"down\" : \"up\" );\r\n\t},\r\n\r\n\t_getDragHorizontalDirection: function() {\r\n\t\tvar delta = this.positionAbs.left - this.lastPositionAbs.left;\r\n\t\treturn delta !== 0 && ( delta > 0 ? \"right\" : \"left\" );\r\n\t},\r\n\r\n\trefresh: function( event ) {\r\n\t\tthis._refreshItems( event );\r\n\t\tthis._setHandleClassName();\r\n\t\tthis.refreshPositions();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_connectWith: function() {\r\n\t\tvar options = this.options;\r\n\t\treturn options.connectWith.constructor === String ?\r\n\t\t\t[ options.connectWith ] :\r\n\t\t\toptions.connectWith;\r\n\t},\r\n\r\n\t_getItemsAsjQuery: function( connected ) {\r\n\r\n\t\tvar i, j, cur, inst,\r\n\t\t\titems = [],\r\n\t\t\tqueries = [],\r\n\t\t\tconnectWith = this._connectWith();\r\n\r\n\t\tif ( connectWith && connected ) {\r\n\t\t\tfor ( i = connectWith.length - 1; i >= 0; i-- ) {\r\n\t\t\t\tcur = $( connectWith[ i ], this.document[ 0 ] );\r\n\t\t\t\tfor ( j = cur.length - 1; j >= 0; j-- ) {\r\n\t\t\t\t\tinst = $.data( cur[ j ], this.widgetFullName );\r\n\t\t\t\t\tif ( inst && inst !== this && !inst.options.disabled ) {\r\n\t\t\t\t\t\tqueries.push( [ $.isFunction( inst.options.items ) ?\r\n\t\t\t\t\t\t\tinst.options.items.call( inst.element ) :\r\n\t\t\t\t\t\t\t$( inst.options.items, inst.element )\r\n\t\t\t\t\t\t\t\t.not( \".ui-sortable-helper\" )\r\n\t\t\t\t\t\t\t\t.not( \".ui-sortable-placeholder\" ), inst ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tqueries.push( [ $.isFunction( this.options.items ) ?\r\n\t\t\tthis.options.items\r\n\t\t\t\t.call( this.element, null, { options: this.options, item: this.currentItem } ) :\r\n\t\t\t$( this.options.items, this.element )\r\n\t\t\t\t.not( \".ui-sortable-helper\" )\r\n\t\t\t\t.not( \".ui-sortable-placeholder\" ), this ] );\r\n\r\n\t\tfunction addItems() {\r\n\t\t\titems.push( this );\r\n\t\t}\r\n\t\tfor ( i = queries.length - 1; i >= 0; i-- ) {\r\n\t\t\tqueries[ i ][ 0 ].each( addItems );\r\n\t\t}\r\n\r\n\t\treturn $( items );\r\n\r\n\t},\r\n\r\n\t_removeCurrentsFromItems: function() {\r\n\r\n\t\tvar list = this.currentItem.find( \":data(\" + this.widgetName + \"-item)\" );\r\n\r\n\t\tthis.items = $.grep( this.items, function( item ) {\r\n\t\t\tfor ( var j = 0; j < list.length; j++ ) {\r\n\t\t\t\tif ( list[ j ] === item.item[ 0 ] ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\t_refreshItems: function( event ) {\r\n\r\n\t\tthis.items = [];\r\n\t\tthis.containers = [ this ];\r\n\r\n\t\tvar i, j, cur, inst, targetData, _queries, item, queriesLength,\r\n\t\t\titems = this.items,\r\n\t\t\tqueries = [ [ $.isFunction( this.options.items ) ?\r\n\t\t\t\tthis.options.items.call( this.element[ 0 ], event, { item: this.currentItem } ) :\r\n\t\t\t\t$( this.options.items, this.element ), this ] ],\r\n\t\t\tconnectWith = this._connectWith();\r\n\r\n\t\t//Shouldn't be run the first time through due to massive slow-down\r\n\t\tif ( connectWith && this.ready ) {\r\n\t\t\tfor ( i = connectWith.length - 1; i >= 0; i-- ) {\r\n\t\t\t\tcur = $( connectWith[ i ], this.document[ 0 ] );\r\n\t\t\t\tfor ( j = cur.length - 1; j >= 0; j-- ) {\r\n\t\t\t\t\tinst = $.data( cur[ j ], this.widgetFullName );\r\n\t\t\t\t\tif ( inst && inst !== this && !inst.options.disabled ) {\r\n\t\t\t\t\t\tqueries.push( [ $.isFunction( inst.options.items ) ?\r\n\t\t\t\t\t\t\tinst.options.items\r\n\t\t\t\t\t\t\t\t.call( inst.element[ 0 ], event, { item: this.currentItem } ) :\r\n\t\t\t\t\t\t\t$( inst.options.items, inst.element ), inst ] );\r\n\t\t\t\t\t\tthis.containers.push( inst );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( i = queries.length - 1; i >= 0; i-- ) {\r\n\t\t\ttargetData = queries[ i ][ 1 ];\r\n\t\t\t_queries = queries[ i ][ 0 ];\r\n\r\n\t\t\tfor ( j = 0, queriesLength = _queries.length; j < queriesLength; j++ ) {\r\n\t\t\t\titem = $( _queries[ j ] );\r\n\r\n\t\t\t\t// Data for target checking (mouse manager)\r\n\t\t\t\titem.data( this.widgetName + \"-item\", targetData );\r\n\r\n\t\t\t\titems.push( {\r\n\t\t\t\t\titem: item,\r\n\t\t\t\t\tinstance: targetData,\r\n\t\t\t\t\twidth: 0, height: 0,\r\n\t\t\t\t\tleft: 0, top: 0\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_refreshItemPositions: function( fast ) {\r\n\t\tvar i, item, t, p;\r\n\r\n\t\tfor ( i = this.items.length - 1; i >= 0; i-- ) {\r\n\t\t\titem = this.items[ i ];\r\n\r\n\t\t\t//We ignore calculating positions of all connected containers when we're not over them\r\n\t\t\tif ( this.currentContainer && item.instance !== this.currentContainer &&\r\n\t\t\t\t\titem.item[ 0 ] !== this.currentItem[ 0 ] ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tt = this.options.toleranceElement ?\r\n\t\t\t\t$( this.options.toleranceElement, item.item ) :\r\n\t\t\t\titem.item;\r\n\r\n\t\t\tif ( !fast ) {\r\n\t\t\t\titem.width = t.outerWidth();\r\n\t\t\t\titem.height = t.outerHeight();\r\n\t\t\t}\r\n\r\n\t\t\tp = t.offset();\r\n\t\t\titem.left = p.left;\r\n\t\t\titem.top = p.top;\r\n\t\t}\r\n\t},\r\n\r\n\trefreshPositions: function( fast ) {\r\n\r\n\t\t// Determine whether items are being displayed horizontally\r\n\t\tthis.floating = this.items.length ?\r\n\t\t\tthis.options.axis === \"x\" || this._isFloating( this.items[ 0 ].item ) :\r\n\t\t\tfalse;\r\n\r\n\t\tif ( this.innermostContainer !== null ) {\r\n\t\t\tthis._refreshItemPositions( fast );\r\n\t\t}\r\n\r\n\t\tvar i, p;\r\n\r\n\t\tif ( this.options.custom && this.options.custom.refreshContainers ) {\r\n\t\t\tthis.options.custom.refreshContainers.call( this );\r\n\t\t} else {\r\n\t\t\tfor ( i = this.containers.length - 1; i >= 0; i-- ) {\r\n\t\t\t\tp = this.containers[ i ].element.offset();\r\n\t\t\t\tthis.containers[ i ].containerCache.left = p.left;\r\n\t\t\t\tthis.containers[ i ].containerCache.top = p.top;\r\n\t\t\t\tthis.containers[ i ].containerCache.width =\r\n\t\t\t\t\tthis.containers[ i ].element.outerWidth();\r\n\t\t\t\tthis.containers[ i ].containerCache.height =\r\n\t\t\t\t\tthis.containers[ i ].element.outerHeight();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t_createPlaceholder: function( that ) {\r\n\t\tthat = that || this;\r\n\t\tvar className, nodeName,\r\n\t\t\to = that.options;\r\n\r\n\t\tif ( !o.placeholder || o.placeholder.constructor === String ) {\r\n\t\t\tclassName = o.placeholder;\r\n\t\t\tnodeName = that.currentItem[ 0 ].nodeName.toLowerCase();\r\n\t\t\to.placeholder = {\r\n\t\t\t\telement: function() {\r\n\r\n\t\t\t\t\tvar element = $( \"<\" + nodeName + \">\", that.document[ 0 ] );\r\n\r\n\t\t\t\t\tthat._addClass( element, \"ui-sortable-placeholder\",\r\n\t\t\t\t\t\t\tclassName || that.currentItem[ 0 ].className )\r\n\t\t\t\t\t\t._removeClass( element, \"ui-sortable-helper\" );\r\n\r\n\t\t\t\t\tif ( nodeName === \"tbody\" ) {\r\n\t\t\t\t\t\tthat._createTrPlaceholder(\r\n\t\t\t\t\t\t\tthat.currentItem.find( \"tr\" ).eq( 0 ),\r\n\t\t\t\t\t\t\t$( \"<tr>\", that.document[ 0 ] ).appendTo( element )\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else if ( nodeName === \"tr\" ) {\r\n\t\t\t\t\t\tthat._createTrPlaceholder( that.currentItem, element );\r\n\t\t\t\t\t} else if ( nodeName === \"img\" ) {\r\n\t\t\t\t\t\telement.attr( \"src\", that.currentItem.attr( \"src\" ) );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( !className ) {\r\n\t\t\t\t\t\telement.css( \"visibility\", \"hidden\" );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn element;\r\n\t\t\t\t},\r\n\t\t\t\tupdate: function( container, p ) {\r\n\r\n\t\t\t\t\t// 1. If a className is set as 'placeholder option, we don't force sizes -\r\n\t\t\t\t\t// the class is responsible for that\r\n\t\t\t\t\t// 2. The option 'forcePlaceholderSize can be enabled to force it even if a\r\n\t\t\t\t\t// class name is specified\r\n\t\t\t\t\tif ( className && !o.forcePlaceholderSize ) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If the element doesn't have a actual height or width by itself (without\r\n\t\t\t\t\t// styles coming from a stylesheet), it receives the inline height and width\r\n\t\t\t\t\t// from the dragged item. Or, if it's a tbody or tr, it's going to have a height\r\n\t\t\t\t\t// anyway since we're populating them with <td>s above, but they're unlikely to\r\n\t\t\t\t\t// be the correct height on their own if the row heights are dynamic, so we'll\r\n\t\t\t\t\t// always assign the height of the dragged item given forcePlaceholderSize\r\n\t\t\t\t\t// is true.\r\n\t\t\t\t\tif ( !p.height() || ( o.forcePlaceholderSize &&\r\n\t\t\t\t\t\t\t( nodeName === \"tbody\" || nodeName === \"tr\" ) ) ) {\r\n\t\t\t\t\t\tp.height(\r\n\t\t\t\t\t\t\tthat.currentItem.innerHeight() -\r\n\t\t\t\t\t\t\tparseInt( that.currentItem.css( \"paddingTop\" ) || 0, 10 ) -\r\n\t\t\t\t\t\t\tparseInt( that.currentItem.css( \"paddingBottom\" ) || 0, 10 ) );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( !p.width() ) {\r\n\t\t\t\t\t\tp.width(\r\n\t\t\t\t\t\t\tthat.currentItem.innerWidth() -\r\n\t\t\t\t\t\t\tparseInt( that.currentItem.css( \"paddingLeft\" ) || 0, 10 ) -\r\n\t\t\t\t\t\t\tparseInt( that.currentItem.css( \"paddingRight\" ) || 0, 10 ) );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t//Create the placeholder\r\n\t\tthat.placeholder = $( o.placeholder.element.call( that.element, that.currentItem ) );\r\n\r\n\t\t//Append it after the actual current item\r\n\t\tthat.currentItem.after( that.placeholder );\r\n\r\n\t\t//Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)\r\n\t\to.placeholder.update( that, that.placeholder );\r\n\r\n\t},\r\n\r\n\t_createTrPlaceholder: function( sourceTr, targetTr ) {\r\n\t\tvar that = this;\r\n\r\n\t\tsourceTr.children().each( function() {\r\n\t\t\t$( \"<td>&#160;</td>\", that.document[ 0 ] )\r\n\t\t\t\t.attr( \"colspan\", $( this ).attr( \"colspan\" ) || 1 )\r\n\t\t\t\t.appendTo( targetTr );\r\n\t\t} );\r\n\t},\r\n\r\n\t_contactContainers: function( event ) {\r\n\t\tvar i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,\r\n\t\t\tfloating, axis,\r\n\t\t\tinnermostContainer = null,\r\n\t\t\tinnermostIndex = null;\r\n\r\n\t\t// Get innermost container that intersects with item\r\n\t\tfor ( i = this.containers.length - 1; i >= 0; i-- ) {\r\n\r\n\t\t\t// Never consider a container that's located within the item itself\r\n\t\t\tif ( $.contains( this.currentItem[ 0 ], this.containers[ i ].element[ 0 ] ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._intersectsWith( this.containers[ i ].containerCache ) ) {\r\n\r\n\t\t\t\t// If we've already found a container and it's more \"inner\" than this, then continue\r\n\t\t\t\tif ( innermostContainer &&\r\n\t\t\t\t\t\t$.contains(\r\n\t\t\t\t\t\t\tthis.containers[ i ].element[ 0 ],\r\n\t\t\t\t\t\t\tinnermostContainer.element[ 0 ] ) ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinnermostContainer = this.containers[ i ];\r\n\t\t\t\tinnermostIndex = i;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// container doesn't intersect. trigger \"out\" event if necessary\r\n\t\t\t\tif ( this.containers[ i ].containerCache.over ) {\r\n\t\t\t\t\tthis.containers[ i ]._trigger( \"out\", event, this._uiHash( this ) );\r\n\t\t\t\t\tthis.containers[ i ].containerCache.over = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.innermostContainer = innermostContainer;\r\n\r\n\t\t// If no intersecting containers found, return\r\n\t\tif ( !innermostContainer ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Move the item into the container if it's not there already\r\n\t\tif ( this.containers.length === 1 ) {\r\n\t\t\tif ( !this.containers[ innermostIndex ].containerCache.over ) {\r\n\t\t\t\tthis.containers[ innermostIndex ]._trigger( \"over\", event, this._uiHash( this ) );\r\n\t\t\t\tthis.containers[ innermostIndex ].containerCache.over = 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\t// When entering a new container, we will find the item with the least distance and\r\n\t\t\t// append our item near it\r\n\t\t\tdist = 10000;\r\n\t\t\titemWithLeastDistance = null;\r\n\t\t\tfloating = innermostContainer.floating || this._isFloating( this.currentItem );\r\n\t\t\tposProperty = floating ? \"left\" : \"top\";\r\n\t\t\tsizeProperty = floating ? \"width\" : \"height\";\r\n\t\t\taxis = floating ? \"pageX\" : \"pageY\";\r\n\r\n\t\t\tfor ( j = this.items.length - 1; j >= 0; j-- ) {\r\n\t\t\t\tif ( !$.contains(\r\n\t\t\t\t\t\tthis.containers[ innermostIndex ].element[ 0 ], this.items[ j ].item[ 0 ] )\r\n\t\t\t\t) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif ( this.items[ j ].item[ 0 ] === this.currentItem[ 0 ] ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcur = this.items[ j ].item.offset()[ posProperty ];\r\n\t\t\t\tnearBottom = false;\r\n\t\t\t\tif ( event[ axis ] - cur > this.items[ j ][ sizeProperty ] / 2 ) {\r\n\t\t\t\t\tnearBottom = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( Math.abs( event[ axis ] - cur ) < dist ) {\r\n\t\t\t\t\tdist = Math.abs( event[ axis ] - cur );\r\n\t\t\t\t\titemWithLeastDistance = this.items[ j ];\r\n\t\t\t\t\tthis.direction = nearBottom ? \"up\" : \"down\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//Check if dropOnEmpty is enabled\r\n\t\t\tif ( !itemWithLeastDistance && !this.options.dropOnEmpty ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.currentContainer === this.containers[ innermostIndex ] ) {\r\n\t\t\t\tif ( !this.currentContainer.containerCache.over ) {\r\n\t\t\t\t\tthis.containers[ innermostIndex ]._trigger( \"over\", event, this._uiHash() );\r\n\t\t\t\t\tthis.currentContainer.containerCache.over = 1;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\titemWithLeastDistance ?\r\n\t\t\t\tthis._rearrange( event, itemWithLeastDistance, null, true ) :\r\n\t\t\t\tthis._rearrange( event, null, this.containers[ innermostIndex ].element, true );\r\n\t\t\tthis._trigger( \"change\", event, this._uiHash() );\r\n\t\t\tthis.containers[ innermostIndex ]._trigger( \"change\", event, this._uiHash( this ) );\r\n\t\t\tthis.currentContainer = this.containers[ innermostIndex ];\r\n\r\n\t\t\t//Update the placeholder\r\n\t\t\tthis.options.placeholder.update( this.currentContainer, this.placeholder );\r\n\r\n\t\t\t//Update scrollParent\r\n\t\t\tthis.scrollParent = this.placeholder.scrollParent();\r\n\r\n\t\t\t//Update overflowOffset\r\n\t\t\tif ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\t\tthis.scrollParent[ 0 ].tagName !== \"HTML\" ) {\r\n\t\t\t\tthis.overflowOffset = this.scrollParent.offset();\r\n\t\t\t}\r\n\r\n\t\t\tthis.containers[ innermostIndex ]._trigger( \"over\", event, this._uiHash( this ) );\r\n\t\t\tthis.containers[ innermostIndex ].containerCache.over = 1;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_createHelper: function( event ) {\r\n\r\n\t\tvar o = this.options,\r\n\t\t\thelper = $.isFunction( o.helper ) ?\r\n\t\t\t\t$( o.helper.apply( this.element[ 0 ], [ event, this.currentItem ] ) ) :\r\n\t\t\t\t( o.helper === \"clone\" ? this.currentItem.clone() : this.currentItem );\r\n\r\n\t\t//Add the helper to the DOM if that didn't happen already\r\n\t\tif ( !helper.parents( \"body\" ).length ) {\r\n\t\t\tthis.appendTo[ 0 ].appendChild( helper[ 0 ] );\r\n\t\t}\r\n\r\n\t\tif ( helper[ 0 ] === this.currentItem[ 0 ] ) {\r\n\t\t\tthis._storedCSS = {\r\n\t\t\t\twidth: this.currentItem[ 0 ].style.width,\r\n\t\t\t\theight: this.currentItem[ 0 ].style.height,\r\n\t\t\t\tposition: this.currentItem.css( \"position\" ),\r\n\t\t\t\ttop: this.currentItem.css( \"top\" ),\r\n\t\t\t\tleft: this.currentItem.css( \"left\" )\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif ( !helper[ 0 ].style.width || o.forceHelperSize ) {\r\n\t\t\thelper.width( this.currentItem.width() );\r\n\t\t}\r\n\t\tif ( !helper[ 0 ].style.height || o.forceHelperSize ) {\r\n\t\t\thelper.height( this.currentItem.height() );\r\n\t\t}\r\n\r\n\t\treturn helper;\r\n\r\n\t},\r\n\r\n\t_adjustOffsetFromHelper: function( obj ) {\r\n\t\tif ( typeof obj === \"string\" ) {\r\n\t\t\tobj = obj.split( \" \" );\r\n\t\t}\r\n\t\tif ( $.isArray( obj ) ) {\r\n\t\t\tobj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };\r\n\t\t}\r\n\t\tif ( \"left\" in obj ) {\r\n\t\t\tthis.offset.click.left = obj.left + this.margins.left;\r\n\t\t}\r\n\t\tif ( \"right\" in obj ) {\r\n\t\t\tthis.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;\r\n\t\t}\r\n\t\tif ( \"top\" in obj ) {\r\n\t\t\tthis.offset.click.top = obj.top + this.margins.top;\r\n\t\t}\r\n\t\tif ( \"bottom\" in obj ) {\r\n\t\t\tthis.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;\r\n\t\t}\r\n\t},\r\n\r\n\t_getParentOffset: function() {\r\n\r\n\t\t//Get the offsetParent and cache its position\r\n\t\tthis.offsetParent = this.helper.offsetParent();\r\n\t\tvar po = this.offsetParent.offset();\r\n\r\n\t\t// This is a special case where we need to modify a offset calculated on start, since the\r\n\t\t// following happened:\r\n\t\t// 1. The position of the helper is absolute, so it's position is calculated based on the\r\n\t\t// next positioned parent\r\n\t\t// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't\r\n\t\t// the document, which means that the scroll is included in the initial calculation of the\r\n\t\t// offset of the parent, and never recalculated upon drag\r\n\t\tif ( this.cssPosition === \"absolute\" && this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\t$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {\r\n\t\t\tpo.left += this.scrollParent.scrollLeft();\r\n\t\t\tpo.top += this.scrollParent.scrollTop();\r\n\t\t}\r\n\r\n\t\t// This needs to be actually done for all browsers, since pageX/pageY includes this\r\n\t\t// information with an ugly IE fix\r\n\t\tif ( this.offsetParent[ 0 ] === this.document[ 0 ].body ||\r\n\t\t\t\t( this.offsetParent[ 0 ].tagName &&\r\n\t\t\t\tthis.offsetParent[ 0 ].tagName.toLowerCase() === \"html\" && $.ui.ie ) ) {\r\n\t\t\tpo = { top: 0, left: 0 };\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttop: po.top + ( parseInt( this.offsetParent.css( \"borderTopWidth\" ), 10 ) || 0 ),\r\n\t\t\tleft: po.left + ( parseInt( this.offsetParent.css( \"borderLeftWidth\" ), 10 ) || 0 )\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t_getRelativeOffset: function() {\r\n\r\n\t\tif ( this.cssPosition === \"relative\" ) {\r\n\t\t\tvar p = this.currentItem.position();\r\n\t\t\treturn {\r\n\t\t\t\ttop: p.top - ( parseInt( this.helper.css( \"top\" ), 10 ) || 0 ) +\r\n\t\t\t\t\tthis.scrollParent.scrollTop(),\r\n\t\t\t\tleft: p.left - ( parseInt( this.helper.css( \"left\" ), 10 ) || 0 ) +\r\n\t\t\t\t\tthis.scrollParent.scrollLeft()\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn { top: 0, left: 0 };\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_cacheMargins: function() {\r\n\t\tthis.margins = {\r\n\t\t\tleft: ( parseInt( this.currentItem.css( \"marginLeft\" ), 10 ) || 0 ),\r\n\t\t\ttop: ( parseInt( this.currentItem.css( \"marginTop\" ), 10 ) || 0 )\r\n\t\t};\r\n\t},\r\n\r\n\t_cacheHelperProportions: function() {\r\n\t\tthis.helperProportions = {\r\n\t\t\twidth: this.helper.outerWidth(),\r\n\t\t\theight: this.helper.outerHeight()\r\n\t\t};\r\n\t},\r\n\r\n\t_setContainment: function() {\r\n\r\n\t\tvar ce, co, over,\r\n\t\t\to = this.options;\r\n\t\tif ( o.containment === \"parent\" ) {\r\n\t\t\to.containment = this.helper[ 0 ].parentNode;\r\n\t\t}\r\n\t\tif ( o.containment === \"document\" || o.containment === \"window\" ) {\r\n\t\t\tthis.containment = [\r\n\t\t\t\t0 - this.offset.relative.left - this.offset.parent.left,\r\n\t\t\t\t0 - this.offset.relative.top - this.offset.parent.top,\r\n\t\t\t\to.containment === \"document\" ?\r\n\t\t\t\t\tthis.document.width() :\r\n\t\t\t\t\tthis.window.width() - this.helperProportions.width - this.margins.left,\r\n\t\t\t\t( o.containment === \"document\" ?\r\n\t\t\t\t\t( this.document.height() || document.body.parentNode.scrollHeight ) :\r\n\t\t\t\t\tthis.window.height() || this.document[ 0 ].body.parentNode.scrollHeight\r\n\t\t\t\t) - this.helperProportions.height - this.margins.top\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tif ( !( /^(document|window|parent)$/ ).test( o.containment ) ) {\r\n\t\t\tce = $( o.containment )[ 0 ];\r\n\t\t\tco = $( o.containment ).offset();\r\n\t\t\tover = ( $( ce ).css( \"overflow\" ) !== \"hidden\" );\r\n\r\n\t\t\tthis.containment = [\r\n\t\t\t\tco.left + ( parseInt( $( ce ).css( \"borderLeftWidth\" ), 10 ) || 0 ) +\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"paddingLeft\" ), 10 ) || 0 ) - this.margins.left,\r\n\t\t\t\tco.top + ( parseInt( $( ce ).css( \"borderTopWidth\" ), 10 ) || 0 ) +\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"paddingTop\" ), 10 ) || 0 ) - this.margins.top,\r\n\t\t\t\tco.left + ( over ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"borderLeftWidth\" ), 10 ) || 0 ) -\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"paddingRight\" ), 10 ) || 0 ) -\r\n\t\t\t\t\tthis.helperProportions.width - this.margins.left,\r\n\t\t\t\tco.top + ( over ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"borderTopWidth\" ), 10 ) || 0 ) -\r\n\t\t\t\t\t( parseInt( $( ce ).css( \"paddingBottom\" ), 10 ) || 0 ) -\r\n\t\t\t\t\tthis.helperProportions.height - this.margins.top\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_convertPositionTo: function( d, pos ) {\r\n\r\n\t\tif ( !pos ) {\r\n\t\t\tpos = this.position;\r\n\t\t}\r\n\t\tvar mod = d === \"absolute\" ? 1 : -1,\r\n\t\t\tscroll = this.cssPosition === \"absolute\" &&\r\n\t\t\t\t!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\t$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?\r\n\t\t\t\t\tthis.offsetParent :\r\n\t\t\t\t\tthis.scrollParent,\r\n\t\t\tscrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );\r\n\r\n\t\treturn {\r\n\t\t\ttop: (\r\n\r\n\t\t\t\t// The absolute mouse position\r\n\t\t\t\tpos.top\t+\r\n\r\n\t\t\t\t// Only for relative positioned nodes: Relative offset from element to offset parent\r\n\t\t\t\tthis.offset.relative.top * mod +\r\n\r\n\t\t\t\t// The offsetParent's offset without borders (offset + border)\r\n\t\t\t\tthis.offset.parent.top * mod -\r\n\t\t\t\t( ( this.cssPosition === \"fixed\" ?\r\n\t\t\t\t\t-this.scrollParent.scrollTop() :\r\n\t\t\t\t\t( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) * mod )\r\n\t\t\t),\r\n\t\t\tleft: (\r\n\r\n\t\t\t\t// The absolute mouse position\r\n\t\t\t\tpos.left +\r\n\r\n\t\t\t\t// Only for relative positioned nodes: Relative offset from element to offset parent\r\n\t\t\t\tthis.offset.relative.left * mod +\r\n\r\n\t\t\t\t// The offsetParent's offset without borders (offset + border)\r\n\t\t\t\tthis.offset.parent.left * mod\t-\r\n\t\t\t\t( ( this.cssPosition === \"fixed\" ?\r\n\t\t\t\t\t-this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :\r\n\t\t\t\t\tscroll.scrollLeft() ) * mod )\r\n\t\t\t)\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t_generatePosition: function( event ) {\r\n\r\n\t\tvar top, left,\r\n\t\t\to = this.options,\r\n\t\t\tpageX = event.pageX,\r\n\t\t\tpageY = event.pageY,\r\n\t\t\tscroll = this.cssPosition === \"absolute\" &&\r\n\t\t\t\t!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\t$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?\r\n\t\t\t\t\tthis.offsetParent :\r\n\t\t\t\t\tthis.scrollParent,\r\n\t\t\t\tscrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );\r\n\r\n\t\t// This is another very weird special case that only happens for relative elements:\r\n\t\t// 1. If the css position is relative\r\n\t\t// 2. and the scroll parent is the document or similar to the offset parent\r\n\t\t// we have to refresh the relative offset during the scroll so there are no jumps\r\n\t\tif ( this.cssPosition === \"relative\" && !( this.scrollParent[ 0 ] !== this.document[ 0 ] &&\r\n\t\t\t\tthis.scrollParent[ 0 ] !== this.offsetParent[ 0 ] ) ) {\r\n\t\t\tthis.offset.relative = this._getRelativeOffset();\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t * - Position constraining -\r\n\t\t * Constrain the position to a mix of grid, containment.\r\n\t\t */\r\n\r\n\t\tif ( this.originalPosition ) { //If we are not dragging yet, we won't check for options\r\n\r\n\t\t\tif ( this.containment ) {\r\n\t\t\t\tif ( event.pageX - this.offset.click.left < this.containment[ 0 ] ) {\r\n\t\t\t\t\tpageX = this.containment[ 0 ] + this.offset.click.left;\r\n\t\t\t\t}\r\n\t\t\t\tif ( event.pageY - this.offset.click.top < this.containment[ 1 ] ) {\r\n\t\t\t\t\tpageY = this.containment[ 1 ] + this.offset.click.top;\r\n\t\t\t\t}\r\n\t\t\t\tif ( event.pageX - this.offset.click.left > this.containment[ 2 ] ) {\r\n\t\t\t\t\tpageX = this.containment[ 2 ] + this.offset.click.left;\r\n\t\t\t\t}\r\n\t\t\t\tif ( event.pageY - this.offset.click.top > this.containment[ 3 ] ) {\r\n\t\t\t\t\tpageY = this.containment[ 3 ] + this.offset.click.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( o.grid ) {\r\n\t\t\t\ttop = this.originalPageY + Math.round( ( pageY - this.originalPageY ) /\r\n\t\t\t\t\to.grid[ 1 ] ) * o.grid[ 1 ];\r\n\t\t\t\tpageY = this.containment ?\r\n\t\t\t\t\t( ( top - this.offset.click.top >= this.containment[ 1 ] &&\r\n\t\t\t\t\t\ttop - this.offset.click.top <= this.containment[ 3 ] ) ?\r\n\t\t\t\t\t\t\ttop :\r\n\t\t\t\t\t\t\t( ( top - this.offset.click.top >= this.containment[ 1 ] ) ?\r\n\t\t\t\t\t\t\t\ttop - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) :\r\n\t\t\t\t\t\t\t\ttop;\r\n\r\n\t\t\t\tleft = this.originalPageX + Math.round( ( pageX - this.originalPageX ) /\r\n\t\t\t\t\to.grid[ 0 ] ) * o.grid[ 0 ];\r\n\t\t\t\tpageX = this.containment ?\r\n\t\t\t\t\t( ( left - this.offset.click.left >= this.containment[ 0 ] &&\r\n\t\t\t\t\t\tleft - this.offset.click.left <= this.containment[ 2 ] ) ?\r\n\t\t\t\t\t\t\tleft :\r\n\t\t\t\t\t\t\t( ( left - this.offset.click.left >= this.containment[ 0 ] ) ?\r\n\t\t\t\t\t\t\t\tleft - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) :\r\n\t\t\t\t\t\t\t\tleft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttop: (\r\n\r\n\t\t\t\t// The absolute mouse position\r\n\t\t\t\tpageY -\r\n\r\n\t\t\t\t// Click offset (relative to the element)\r\n\t\t\t\tthis.offset.click.top -\r\n\r\n\t\t\t\t// Only for relative positioned nodes: Relative offset from element to offset parent\r\n\t\t\t\tthis.offset.relative.top -\r\n\r\n\t\t\t\t// The offsetParent's offset without borders (offset + border)\r\n\t\t\t\tthis.offset.parent.top +\r\n\t\t\t\t( ( this.cssPosition === \"fixed\" ?\r\n\t\t\t\t\t-this.scrollParent.scrollTop() :\r\n\t\t\t\t\t( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) )\r\n\t\t\t),\r\n\t\t\tleft: (\r\n\r\n\t\t\t\t// The absolute mouse position\r\n\t\t\t\tpageX -\r\n\r\n\t\t\t\t// Click offset (relative to the element)\r\n\t\t\t\tthis.offset.click.left -\r\n\r\n\t\t\t\t// Only for relative positioned nodes: Relative offset from element to offset parent\r\n\t\t\t\tthis.offset.relative.left -\r\n\r\n\t\t\t\t// The offsetParent's offset without borders (offset + border)\r\n\t\t\t\tthis.offset.parent.left +\r\n\t\t\t\t( ( this.cssPosition === \"fixed\" ?\r\n\t\t\t\t\t-this.scrollParent.scrollLeft() :\r\n\t\t\t\t\tscrollIsRootNode ? 0 : scroll.scrollLeft() ) )\r\n\t\t\t)\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t_rearrange: function( event, i, a, hardRefresh ) {\r\n\r\n\t\ta ? a[ 0 ].appendChild( this.placeholder[ 0 ] ) :\r\n\t\t\ti.item[ 0 ].parentNode.insertBefore( this.placeholder[ 0 ],\r\n\t\t\t\t( this.direction === \"down\" ? i.item[ 0 ] : i.item[ 0 ].nextSibling ) );\r\n\r\n\t\t//Various things done here to improve the performance:\r\n\t\t// 1. we create a setTimeout, that calls refreshPositions\r\n\t\t// 2. on the instance, we have a counter variable, that get's higher after every append\r\n\t\t// 3. on the local scope, we copy the counter variable, and check in the timeout,\r\n\t\t// if it's still the same\r\n\t\t// 4. this lets only the last addition to the timeout stack through\r\n\t\tthis.counter = this.counter ? ++this.counter : 1;\r\n\t\tvar counter = this.counter;\r\n\r\n\t\tthis._delay( function() {\r\n\t\t\tif ( counter === this.counter ) {\r\n\r\n\t\t\t\t//Precompute after each DOM insertion, NOT on mousemove\r\n\t\t\t\tthis.refreshPositions( !hardRefresh );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\t_clear: function( event, noPropagation ) {\r\n\r\n\t\tthis.reverting = false;\r\n\r\n\t\t// We delay all events that have to be triggered to after the point where the placeholder\r\n\t\t// has been removed and everything else normalized again\r\n\t\tvar i,\r\n\t\t\tdelayedTriggers = [];\r\n\r\n\t\t// We first have to update the dom position of the actual currentItem\r\n\t\t// Note: don't do it if the current item is already removed (by a user), or it gets\r\n\t\t// reappended (see #4088)\r\n\t\tif ( !this._noFinalSort && this.currentItem.parent().length ) {\r\n\t\t\tthis.placeholder.before( this.currentItem );\r\n\t\t}\r\n\t\tthis._noFinalSort = null;\r\n\r\n\t\tif ( this.helper[ 0 ] === this.currentItem[ 0 ] ) {\r\n\t\t\tfor ( i in this._storedCSS ) {\r\n\t\t\t\tif ( this._storedCSS[ i ] === \"auto\" || this._storedCSS[ i ] === \"static\" ) {\r\n\t\t\t\t\tthis._storedCSS[ i ] = \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.currentItem.css( this._storedCSS );\r\n\t\t\tthis._removeClass( this.currentItem, \"ui-sortable-helper\" );\r\n\t\t} else {\r\n\t\t\tthis.currentItem.show();\r\n\t\t}\r\n\r\n\t\tif ( this.fromOutside && !noPropagation ) {\r\n\t\t\tdelayedTriggers.push( function( event ) {\r\n\t\t\t\tthis._trigger( \"receive\", event, this._uiHash( this.fromOutside ) );\r\n\t\t\t} );\r\n\t\t}\r\n\t\tif ( ( this.fromOutside ||\r\n\t\t\t\tthis.domPosition.prev !==\r\n\t\t\t\tthis.currentItem.prev().not( \".ui-sortable-helper\" )[ 0 ] ||\r\n\t\t\t\tthis.domPosition.parent !== this.currentItem.parent()[ 0 ] ) && !noPropagation ) {\r\n\r\n\t\t\t// Trigger update callback if the DOM position has changed\r\n\t\t\tdelayedTriggers.push( function( event ) {\r\n\t\t\t\tthis._trigger( \"update\", event, this._uiHash() );\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\t// Check if the items Container has Changed and trigger appropriate\r\n\t\t// events.\r\n\t\tif ( this !== this.currentContainer ) {\r\n\t\t\tif ( !noPropagation ) {\r\n\t\t\t\tdelayedTriggers.push( function( event ) {\r\n\t\t\t\t\tthis._trigger( \"remove\", event, this._uiHash() );\r\n\t\t\t\t} );\r\n\t\t\t\tdelayedTriggers.push( ( function( c ) {\r\n\t\t\t\t\treturn function( event ) {\r\n\t\t\t\t\t\tc._trigger( \"receive\", event, this._uiHash( this ) );\r\n\t\t\t\t\t};\r\n\t\t\t\t} ).call( this, this.currentContainer ) );\r\n\t\t\t\tdelayedTriggers.push( ( function( c ) {\r\n\t\t\t\t\treturn function( event ) {\r\n\t\t\t\t\t\tc._trigger( \"update\", event, this._uiHash( this ) );\r\n\t\t\t\t\t};\r\n\t\t\t\t} ).call( this, this.currentContainer ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Post events to containers\r\n\t\tfunction delayEvent( type, instance, container ) {\r\n\t\t\treturn function( event ) {\r\n\t\t\t\tcontainer._trigger( type, event, instance._uiHash( instance ) );\r\n\t\t\t};\r\n\t\t}\r\n\t\tfor ( i = this.containers.length - 1; i >= 0; i-- ) {\r\n\t\t\tif ( !noPropagation ) {\r\n\t\t\t\tdelayedTriggers.push( delayEvent( \"deactivate\", this, this.containers[ i ] ) );\r\n\t\t\t}\r\n\t\t\tif ( this.containers[ i ].containerCache.over ) {\r\n\t\t\t\tdelayedTriggers.push( delayEvent( \"out\", this, this.containers[ i ] ) );\r\n\t\t\t\tthis.containers[ i ].containerCache.over = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Do what was originally in plugins\r\n\t\tif ( this.storedCursor ) {\r\n\t\t\tthis.document.find( \"body\" ).css( \"cursor\", this.storedCursor );\r\n\t\t\tthis.storedStylesheet.remove();\r\n\t\t}\r\n\t\tif ( this._storedOpacity ) {\r\n\t\t\tthis.helper.css( \"opacity\", this._storedOpacity );\r\n\t\t}\r\n\t\tif ( this._storedZIndex ) {\r\n\t\t\tthis.helper.css( \"zIndex\", this._storedZIndex === \"auto\" ? \"\" : this._storedZIndex );\r\n\t\t}\r\n\r\n\t\tthis.dragging = false;\r\n\r\n\t\tif ( !noPropagation ) {\r\n\t\t\tthis._trigger( \"beforeStop\", event, this._uiHash() );\r\n\t\t}\r\n\r\n\t\t//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,\r\n\t\t// it unbinds ALL events from the original node!\r\n\t\tthis.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );\r\n\r\n\t\tif ( !this.cancelHelperRemoval ) {\r\n\t\t\tif ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {\r\n\t\t\t\tthis.helper.remove();\r\n\t\t\t}\r\n\t\t\tthis.helper = null;\r\n\t\t}\r\n\r\n\t\tif ( !noPropagation ) {\r\n\t\t\tfor ( i = 0; i < delayedTriggers.length; i++ ) {\r\n\r\n\t\t\t\t// Trigger all delayed events\r\n\t\t\t\tdelayedTriggers[ i ].call( this, event );\r\n\t\t\t}\r\n\t\t\tthis._trigger( \"stop\", event, this._uiHash() );\r\n\t\t}\r\n\r\n\t\tthis.fromOutside = false;\r\n\t\treturn !this.cancelHelperRemoval;\r\n\r\n\t},\r\n\r\n\t_trigger: function() {\r\n\t\tif ( $.Widget.prototype._trigger.apply( this, arguments ) === false ) {\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t},\r\n\r\n\t_uiHash: function( _inst ) {\r\n\t\tvar inst = _inst || this;\r\n\t\treturn {\r\n\t\t\thelper: inst.helper,\r\n\t\t\tplaceholder: inst.placeholder || $( [] ),\r\n\t\t\tposition: inst.position,\r\n\t\t\toriginalPosition: inst.originalPosition,\r\n\t\t\toffset: inst.positionAbs,\r\n\t\t\titem: inst.currentItem,\r\n\t\t\tsender: _inst ? _inst.element : null\r\n\t\t};\r\n\t}\r\n\r\n} );\r\n\r\n});\r\n"]}